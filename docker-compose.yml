version: '3.7'
services:
        web:
                image: nginx_vitor:latest
                ports:
                  - "8080:80"
                networks:
                        redinha:
                                aliases:
                                  - nginx_container
        exporter:
                depends_on:
                  - "web"
                image: nginx/nginx-prometheus-exporter:0.4.2
                environment:
                  #- SCRAPE_URI=http://18.219.219.70:8080/metrics
                  - SCRAPE_URI=http://localhost:8080/metrics
                  - TELEMETRY_PATH=/prometheus
                  - NGINX_RETRIES=10
                ports: 
                  - "9113:9113"
                networks:
                        redinha:
                                aliases:
                                  - prometheus_exporter
                #links:
                 # - web

        prometheus:
                image: prom/prometheus
                ports:
                  - "9090:9090"
                volumes:
                  - ./prometheus.yml:/etc/prometheus/prometheus.yml
                networks:
                        redinha:
                                aliases:
                                  - prometheus_container
                links:
                  - exporter
        grafana:
                image: grafana/grafana
                ports:
                  - "3000:3000"
                networks:
                        redinha:
                                aliases:
                                  - grafana_container
                links:
                  - prometheus

networks:
  redinha:
